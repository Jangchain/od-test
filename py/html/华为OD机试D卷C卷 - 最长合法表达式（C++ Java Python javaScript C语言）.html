
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="200_4"></a>题目描述：最长合法表达式（本题分值200）</h2> 
<p>提取字符串中的最长合法简单数学表达式字符串长度最长的，并计算表达式的值。如果没有返回 0<br> 简单数学表达式只能包含以下内容<br> 0-9 数字，符号±*<br> 说明:<br> 1.所有数字，计算结果都不超过 long</p> 
<p>2.如果有多个长度一样的，请返回第一个表达式的结果</p> 
<p>3.数学表达式，必须是最长的，合法的<br> 4.操作符不能连续出现，如 ±-+1 是不合法的</p> 
<p><strong>输入描述</strong><br> 字符串<br> <strong>输出描述</strong><br> 表达式值<br> <strong>示例一</strong><br> 输入<br> 1-2abcd<br> 输出</p> 
<p>-1</p> 
<h2><a id="_28"></a>输入描述</h2> 
<p>字符串</p> 
<h2><a id="_32"></a>输出描述</h2> 
<p>表达式值</p> 
<h2><a id="_36"></a>用例</h2> 
<p>输入</p> 
<pre><code>1-2abcd
</code></pre> 
<p>输出</p> 
<pre><code>-1
</code></pre> 
<h2><a id="_52"></a>提示,必看！！！</h2> 
<p>本题存在各种歧义，不同的考友给了很多反馈。</p> 
<ol><li>首先本题是100分值的题目，如果按照大多数人的想法，提取出最长的表达式，例如：<code>1+2*33+44+55+abc</code>,应该提取出<code>1+2*33+44+55</code>,那么这题的分值应该是200分。但是根据题意啊，**提取字符串中的最长合法简单数学表达式 **以及结合考友的反馈这题应该是只含有两个操作数以及操作符的表达式，也就是形如a + b，a - b，a * b的表达式，但是a前面有没有正负号不清楚。<strong>对应解法2</strong></li><li>但是作者查看了很多宣称有100%通过率的题解，发现他们的解法与笔者最开始的解法一致，也就是找最长的，而且默认题意中的说明4：操作符不能连续出现，如 ±-+1 是不合法的，也就是官方用例不会出现<code>1+-1</code>类似这样的用例。<strong>对应解法1</strong></li></ol> 
<p>根据上面两种情况，笔者提供了两种解法，大家机考的时候都可以试试，哪种通过率高就用那种！！！</p> 
<h2><a id="1_65"></a>解法1</h2> 
<ol><li> <p>首先，我们需要从输入的字符串中提取出所有的合法数学表达式。在这里，一个合法的数学表达式是指由数字和操作符（+、-、*）组成的字符串，且操作符不能连续出现。我们通过遍历输入字符串的每个字符，并使用一个变量<code>start</code>来记录当前表达式的开始索引，来实现这一步。当我们遇到一个数字字符时，如果<code>start</code>为-1（表示我们还没有开始记录一个新的表达式），我们就将<code>start</code>设置为当前索引；当我们遇到一个操作符字符时，如果前一个字符不是操作符，我们就将当前索引加1；否则，我们就提取从<code>start</code>到当前索引的子字符串作为一个表达式，并将<code>start</code>重置为-1。如果我们遇到一个既不是数字也不是操作符的字符，并且<code>start</code>不为-1，我们也会提取从<code>start</code>到当前索引的子字符串作为一个表达式，并将<code>start</code>重置为-1。最后，如果<code>start</code>不为-1，我们会提取从<code>start</code>到字符串末尾的子字符串作为一个表达式。</p> </li><li> <p>然后，我们需要对提取出的所有表达式按长度进行排序，并选择长度最长的表达式。我们使用Python的<code>sorted</code>函数来实现这一步，其中<code>key=len</code>表示按长度排序，<code>reverse=True</code>表示按降序排序。</p> </li><li> <p>接下来，我们需要计算选出的表达式的结果。我们首先使用正则表达式来分割表达式，得到一个由数字和操作符组成的列表。然后，我们遍历这个列表，先进行所有的乘法操作，然后进行所有的加法和减法操作。在这个过程中，我们使用一个变量<code>result</code>来记录当前的计算结果。</p> </li><li> <p>最后，我们打印出计算结果。如果没有提取出任何表达式，我们就打印0。</p> </li></ol> 
<h2><a id="C1_81"></a>C++解法1</h2> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cctype&gt;</span></span>
using namespace std<span class="token punctuation">;</span>
<span class="token comment">// 提取合法表达式的函数</span>
vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token function">extractExpressions</span><span class="token punctuation">(</span><span class="token keyword">const</span> string <span class="token operator">&amp;</span>line<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> expressions<span class="token punctuation">;</span>
    <span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> line<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">char</span> cur <span class="token operator">=</span> line<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// 如果当前字符是数字</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isdigit</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果开始索引为-1，设置开始索引为当前索引</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                start <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> cur <span class="token operator">==</span> <span class="token char">'-'</span> <span class="token operator">||</span> cur <span class="token operator">==</span> <span class="token char">'*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果当前字符是操作符，并且前一个字符不是操作符</span>
            <span class="token comment">// 则将当前索引加1</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> line<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'-'</span> <span class="token operator">||</span> line<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token operator">++</span>i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 否则，提取从开始索引到当前索引的子字符串作为一个表达式</span>
                <span class="token comment">// 并将开始索引重置为-1</span>
                expressions<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> i <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果当前字符既不是数字也不是操作符</span>
            <span class="token comment">// 并且开始索引不为-1，则提取从开始索引到当前索引的子字符串作为一个表达式</span>
            <span class="token comment">// 并将开始索引重置为-1</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                expressions<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> i <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 如果开始索引不为-1，则提取从开始索引到字符串末尾的子字符串作为一个表达式</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        expressions<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 返回提取的表达式列表</span>
    <span class="token keyword">return</span> expressions<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 计算表达式结果的函数</span>
<span class="token keyword">int</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token keyword">const</span> string <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> tokens<span class="token punctuation">;</span>
    string number<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">char</span> ch <span class="token operator">:</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 如果当前字符是数字，则将其添加到当前数字的末尾</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isdigit</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            number <span class="token operator">+=</span> ch<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 否则，将当前数字和当前操作符添加到元素列表中</span>
            <span class="token comment">// 并开始构建新的数字</span>
            tokens<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tokens<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            number<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 将最后一个数字添加到元素列表中</span>
    tokens<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 遍历元素列表，先进行所有的乘法操作</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tokens<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"*"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">stoi</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            tokens<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">to_string</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tokens<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>tokens<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> tokens<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">--</span>i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 初始化结果为元素列表的第一个数字</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 遍历元素列表，进行所有的加法和减法操作</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tokens<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"+"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">+=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">-=</span> <span class="token function">stoi</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 返回计算结果</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 创建一个字符串来处理输入</span>
    string line<span class="token punctuation">;</span>
    <span class="token comment">// 读取一行输入</span>
    <span class="token function">getline</span><span class="token punctuation">(</span>cin<span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 调用extractExpressions函数提取输入中的合法表达式</span>
    vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> expressions <span class="token operator">=</span> <span class="token function">extractExpressions</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 使用C++的sort函数对表达式按长度进行排序</span>
    <span class="token function">sort</span><span class="token punctuation">(</span>expressions<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> expressions<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> string <span class="token operator">&amp;</span>s1<span class="token punctuation">,</span> <span class="token keyword">const</span> string <span class="token operator">&amp;</span>s2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> s2<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> s1<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果表达式列表不为空，则计算并打印最长表达式的结果</span>
    <span class="token comment">// 否则，打印0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>expressions<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token function">calc</span><span class="token punctuation">(</span>expressions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token number">0</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="Java1_206"></a>Java解法1</h2> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建一个Scanner对象来处理输入</span>
        <span class="token class-name">Scanner</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 读取一行输入</span>
        <span class="token class-name">String</span> line <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 关闭Scanner对象</span>
        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 调用extractExpressions方法提取输入中的合法表达式</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> expressions <span class="token operator">=</span> <span class="token function">extractExpressions</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 使用Java 8的Lambda表达式对表达式按长度进行排序</span>
        expressions<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>s2<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s1<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 如果表达式列表不为空，则计算并打印最长表达式的结果</span>
        <span class="token comment">// 否则，打印0</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>expressions<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>expressions<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 提取合法表达式的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">extractExpressions</span><span class="token punctuation">(</span><span class="token class-name">String</span> line<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建一个列表来存储提取的表达式</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> expressions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 初始化开始索引为-1</span>
        <span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token comment">// 遍历输入字符串的每个字符</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> line<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">char</span> cur <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 如果当前字符是数字</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isDigit</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 如果开始索引为-1，设置开始索引为当前索引</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    start <span class="token operator">=</span> i<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"+-*"</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 如果当前字符是操作符，并且前一个字符不是操作符</span>
                <span class="token comment">// 则将当前索引加1</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">"+-*"</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    i<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 否则，提取从开始索引到当前索引的子字符串作为一个表达式</span>
                    <span class="token comment">// 并将开始索引重置为-1</span>
                    expressions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 如果当前字符既不是数字也不是操作符</span>
                <span class="token comment">// 并且开始索引不为-1，则提取从开始索引到当前索引的子字符串作为一个表达式</span>
                <span class="token comment">// 并将开始索引重置为-1</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    expressions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 如果开始索引不为-1，则提取从开始索引到字符串末尾的子字符串作为一个表达式</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            expressions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 返回提取的表达式列表</span>
        <span class="token keyword">return</span> expressions<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 计算表达式结果的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建一个列表来存储表达式的每个元素（数字或操作符）</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> tokens <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建一个StringBuilder对象来构建数字</span>
        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 遍历表达式的每个字符</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">char</span> ch <span class="token operator">:</span> str<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果当前字符是数字，则将其添加到当前数字的末尾</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isDigit</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 否则，将当前数字和当前操作符添加到元素列表中</span>
                <span class="token comment">// 并开始构建新的数字</span>
                tokens<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                tokens<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                sb<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 将最后一个数字添加到元素列表中</span>
        tokens<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 遍历元素列表，先进行所有的乘法操作</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tokens<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>tokens<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>tokens<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>tokens<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                tokens<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                tokens<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                tokens<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                i<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 初始化结果为元素列表的第一个数字</span>
        <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>tokens<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 遍历元素列表，进行所有的加法和减法操作</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tokens<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>tokens<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                result <span class="token operator">+=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>tokens<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                result <span class="token operator">-=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>tokens<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 返回计算结果</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="javaScript1_336"></a>javaScript解法1</h2> 
<pre><code class="prism language-js"><span class="token keyword">const</span> readline <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'readline'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个readline.Interface实例来处理输入</span>
<span class="token keyword">const</span> rl <span class="token operator">=</span> readline<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">input</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdout
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

rl<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'line'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">line</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 调用extractExpressions函数提取输入中的合法表达式</span>
    <span class="token keyword">let</span> expressions <span class="token operator">=</span> <span class="token function">extractExpressions</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 使用JavaScript的sort函数对表达式按长度进行排序</span>
    expressions<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s1<span class="token punctuation">,</span> s2</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s2<span class="token punctuation">.</span>length <span class="token operator">-</span> s1<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果表达式列表不为空，则计算并打印最长表达式的结果</span>
    <span class="token comment">// 否则，打印0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>expressions<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">calc</span><span class="token punctuation">(</span>expressions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    rl<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 提取合法表达式的函数</span>
<span class="token keyword">function</span> <span class="token function">extractExpressions</span><span class="token punctuation">(</span><span class="token parameter">line</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> expressions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> line<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> cur <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 如果当前字符是数字</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果开始索引为-1，设置开始索引为当前索引</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                start <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"+-*"</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果当前字符是操作符，并且前一个字符不是操作符</span>
            <span class="token comment">// 则将当前索引加1</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">"+-*"</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 否则，提取从开始索引到当前索引的子字符串作为一个表达式</span>
                <span class="token comment">// 并将开始索引重置为-1</span>
                expressions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果当前字符既不是数字也不是操作符</span>
            <span class="token comment">// 并且开始索引不为-1，则提取从开始索引到当前索引的子字符串作为一个表达式</span>
            <span class="token comment">// 并将开始索引重置为-1</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                expressions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 如果开始索引不为-1，则提取从开始索引到字符串末尾的子字符串作为一个表达式</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        expressions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 返回提取的表达式列表</span>
    <span class="token keyword">return</span> expressions<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 计算表达式结果的函数</span>
<span class="token keyword">function</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> number <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> ch <span class="token keyword">of</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 如果当前字符是数字，则将其添加到当前数字的末尾</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            number <span class="token operator">+=</span> ch<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 否则，将当前数字和当前操作符添加到元素列表中</span>
            <span class="token comment">// 并开始构建新的数字</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
            number <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 将最后一个数字添加到元素列表中</span>
    tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 遍历元素列表，先进行所有的乘法操作</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tokens<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">"*"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            tokens<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tokens<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            i<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 初始化结果为元素列表的第一个数字</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 遍历元素列表，进行所有的加法和减法操作</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tokens<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">"+"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">+=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">-=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 返回计算结果</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="Python1_458"></a>Python解法1</h2> 
<pre><code class="prism language-python"><span class="token comment"># 导入需要的模块</span>
<span class="token keyword">import</span> re

<span class="token comment"># 提取合法表达式的函数</span>
<span class="token keyword">def</span> <span class="token function">extract_expressions</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 创建一个列表来存储提取的表达式</span>
    expressions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 初始化开始索引为-1</span>
    start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>

    <span class="token comment"># 遍历输入字符串的每个字符</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        cur <span class="token operator">=</span> line<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

        <span class="token comment"># 如果当前字符是数字</span>
        <span class="token keyword">if</span> cur<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 如果开始索引为-1，设置开始索引为当前索引</span>
            <span class="token keyword">if</span> start <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                start <span class="token operator">=</span> i
        <span class="token keyword">elif</span> start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">and</span> cur <span class="token keyword">in</span> <span class="token string">"+-*"</span><span class="token punctuation">:</span>
            <span class="token comment"># 如果当前字符是操作符，并且前一个字符不是操作符</span>
            <span class="token comment"># 则将当前索引加1</span>
            <span class="token keyword">if</span> line<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token string">"+-*"</span><span class="token punctuation">:</span>
                i <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 否则，提取从开始索引到当前索引的子字符串作为一个表达式</span>
                <span class="token comment"># 并将开始索引重置为-1</span>
                expressions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">[</span>start<span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 如果当前字符既不是数字也不是操作符</span>
            <span class="token comment"># 并且开始索引不为-1，则提取从开始索引到当前索引的子字符串作为一个表达式</span>
            <span class="token comment"># 并将开始索引重置为-1</span>
            <span class="token keyword">if</span> start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                expressions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">[</span>start<span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>

    <span class="token comment"># 如果开始索引不为-1，则提取从开始索引到字符串末尾的子字符串作为一个表达式</span>
    <span class="token keyword">if</span> start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
        expressions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">[</span>start<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 返回提取的表达式列表</span>
    <span class="token keyword">return</span> expressions

<span class="token comment"># 计算表达式结果的函数</span>
<span class="token keyword">def</span> <span class="token function">calc</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 使用正则表达式分割字符串，得到数字和操作符</span>
    tokens <span class="token operator">=</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'([-+*])'</span><span class="token punctuation">,</span> expression<span class="token punctuation">)</span>
    tokens <span class="token operator">=</span> <span class="token punctuation">[</span>token <span class="token keyword">for</span> token <span class="token keyword">in</span> tokens <span class="token keyword">if</span> token<span class="token punctuation">]</span>

    <span class="token comment"># 遍历元素列表，先进行所有的乘法操作</span>
    <span class="token keyword">while</span> <span class="token string">'*'</span> <span class="token keyword">in</span> tokens<span class="token punctuation">:</span>
        index <span class="token operator">=</span> tokens<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span>
        result <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token builtin">int</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        tokens <span class="token operator">=</span> tokens<span class="token punctuation">[</span><span class="token punctuation">:</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> tokens<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

    <span class="token comment"># 初始化结果为元素列表的第一个数字</span>
    result <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># 遍历元素列表，进行所有的加法和减法操作</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'+'</span><span class="token punctuation">:</span>
            result <span class="token operator">+=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            result <span class="token operator">-=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 返回计算结果</span>
    <span class="token keyword">return</span> result

<span class="token comment"># 读取一行输入</span>
line <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 调用extract_expressions函数提取输入中的合法表达式</span>
expressions <span class="token operator">=</span> extract_expressions<span class="token punctuation">(</span>line<span class="token punctuation">)</span>

<span class="token comment"># 使用Python的sorted函数对表达式按长度进行排序</span>
expressions <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>expressions<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 如果表达式列表不为空，则计算并打印最长表达式的结果</span>
<span class="token comment"># 否则，打印0</span>
<span class="token keyword">if</span> expressions<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>calc<span class="token punctuation">(</span>expressions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="C1_545"></a>C语言解法1</h2> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ctype.h&gt;</span></span>

<span class="token comment">// 定义最大表达式数量和最大表达式长度</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX_EXPRESSIONS</span> <span class="token expression"><span class="token number">100</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX_EXPRESSION_LENGTH</span> <span class="token expression"><span class="token number">100</span></span></span>

<span class="token comment">// 提取合法表达式的函数</span>
<span class="token keyword">int</span> <span class="token function">extractExpressions</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>line<span class="token punctuation">,</span> <span class="token keyword">char</span> expressions<span class="token punctuation">[</span>MAX_EXPRESSIONS<span class="token punctuation">]</span><span class="token punctuation">[</span>MAX_EXPRESSION_LENGTH<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> expressionsCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">char</span> cur <span class="token operator">=</span> line<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// 如果当前字符是数字</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isdigit</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                start <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> cur <span class="token operator">==</span> <span class="token char">'-'</span> <span class="token operator">||</span> cur <span class="token operator">==</span> <span class="token char">'*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> line<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'-'</span> <span class="token operator">||</span> line<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token operator">++</span>i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">strncpy</span><span class="token punctuation">(</span>expressions<span class="token punctuation">[</span>expressionsCount<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span> line <span class="token operator">+</span> start<span class="token punctuation">,</span> i <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
                start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">strncpy</span><span class="token punctuation">(</span>expressions<span class="token punctuation">[</span>expressionsCount<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span> line <span class="token operator">+</span> start<span class="token punctuation">,</span> i <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
                start <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">strcpy</span><span class="token punctuation">(</span>expressions<span class="token punctuation">[</span>expressionsCount<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span> line <span class="token operator">+</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> expressionsCount<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 计算表达式结果的函数</span>
<span class="token keyword">int</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> tokens<span class="token punctuation">[</span>MAX_EXPRESSIONS<span class="token punctuation">]</span><span class="token punctuation">[</span>MAX_EXPRESSION_LENGTH<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> tokensCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> number<span class="token punctuation">[</span>MAX_EXPRESSION_LENGTH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isdigit</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">strncat</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> <span class="token operator">&amp;</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">strcpy</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>tokensCount<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">char</span> operator<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token char">'\0'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token function">strcpy</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>tokensCount<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span> operator<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">memset</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">strcpy</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>tokensCount<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tokensCount<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">atoi</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">sprintf</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"%d"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> tokensCount <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">strcpy</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> tokens<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            tokensCount <span class="token operator">-=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token operator">--</span>i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tokensCount<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"+"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">+=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">-=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>tokens<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> line<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">fgets</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    line<span class="token punctuation">[</span><span class="token function">strcspn</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Remove newline character</span>

    <span class="token keyword">char</span> expressions<span class="token punctuation">[</span>MAX_EXPRESSIONS<span class="token punctuation">]</span><span class="token punctuation">[</span>MAX_EXPRESSION_LENGTH<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> expressionsCount <span class="token operator">=</span> <span class="token function">extractExpressions</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> expressions<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 对表达式按长度进行排序</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> expressionsCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> expressionsCount<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>expressions<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span>expressions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">char</span> temp<span class="token punctuation">[</span>MAX_EXPRESSION_LENGTH<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token function">strcpy</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> expressions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">strcpy</span><span class="token punctuation">(</span>expressions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> expressions<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">strcpy</span><span class="token punctuation">(</span>expressions<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>expressionsCount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span>  <span class="token function">calc</span><span class="token punctuation">(</span>expressions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"0\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="2_668"></a>以下是另一个角度的解法2</h2> 
<h2><a id="C2_672"></a>C++解法2</h2> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>

<span class="token comment">// 检查表达式是否有效</span>
bool <span class="token function">isExpressionValid</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> expression<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 获取表达式的第一个字符</span>
    <span class="token keyword">char</span> firstChar <span class="token operator">=</span> expression<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 检查第一个字符是否为运算符或数字，如果不是，则返回false</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>firstChar <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> firstChar <span class="token operator">==</span> <span class="token char">'-'</span> <span class="token operator">||</span> std<span class="token operator">::</span><span class="token function">isdigit</span><span class="token punctuation">(</span>firstChar<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 用于记录运算符的位置</span>
    <span class="token keyword">int</span> operatorIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> expression<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">char</span> currentChar <span class="token operator">=</span> expression<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// 判断当前字符是否为运算符</span>
        bool isOperator <span class="token operator">=</span> currentChar <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> currentChar <span class="token operator">==</span> <span class="token char">'-'</span> <span class="token operator">||</span> currentChar <span class="token operator">==</span> <span class="token char">'*'</span><span class="token punctuation">;</span>
        <span class="token comment">// 判断当前字符是否为数字</span>
        bool isDigit <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">isdigit</span><span class="token punctuation">(</span>currentChar<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果当前字符既不是运算符也不是数字，则表达式无效</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isOperator <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isDigit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 如果找到运算符，并且之前已经记录过运算符的位置，则表达式无效（不允许有多个运算符）</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isOperator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>operatorIndex <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> false<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                operatorIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 防止表达式以双加号或双减号开头，以及表达式以运算符结尾</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>firstChar <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> firstChar <span class="token operator">==</span> <span class="token char">'-'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> operatorIndex <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>operatorIndex <span class="token operator">==</span> expression<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> false<span class="token punctuation">;</span>

    <span class="token comment">// 确保表达式中至少包含一个运算符</span>
    <span class="token keyword">return</span> operatorIndex <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 计算有效表达式的结果</span>
<span class="token keyword">long</span> <span class="token function">calculateExpressionResult</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token operator">::</span>string<span class="token operator">&amp;</span> validExpression<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 找到运算符的位置</span>
    <span class="token class-name">size_t</span> operatorIndex <span class="token operator">=</span> validExpression<span class="token punctuation">.</span><span class="token function">find_first_of</span><span class="token punctuation">(</span><span class="token string">"+-*"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从索引1开始查找</span>

    <span class="token comment">// 获取运算符左边的数和右边的数</span>
    <span class="token keyword">long</span> leftNumber <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">stol</span><span class="token punctuation">(</span>validExpression<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> operatorIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> rightNumber <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">stol</span><span class="token punctuation">(</span>validExpression<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>operatorIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 根据运算符执行相应的计算</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>validExpression<span class="token punctuation">[</span>operatorIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token char">'+'</span><span class="token operator">:</span> <span class="token keyword">return</span> leftNumber <span class="token operator">+</span> rightNumber<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'-'</span><span class="token operator">:</span> <span class="token keyword">return</span> leftNumber <span class="token operator">-</span> rightNumber<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'*'</span><span class="token operator">:</span> <span class="token keyword">return</span> leftNumber <span class="token operator">*</span> rightNumber<span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span> throw std<span class="token operator">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token operator">::</span>string input<span class="token punctuation">;</span>
    std<span class="token operator">::</span><span class="token function">getline</span><span class="token punctuation">(</span>std<span class="token operator">::</span>cin<span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">long</span> maximumResult <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> maxLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// 遍历输入字符串的所有子串</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> start <span class="token operator">&lt;</span> input<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> start<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> end <span class="token operator">=</span> start<span class="token punctuation">;</span> end <span class="token operator">&lt;</span> input<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> end<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            std<span class="token operator">::</span>string subExpression <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end <span class="token operator">-</span> start <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 如果子串是有效的表达式，并且长度大于当前记录的最长长度，则计算结果</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isExpressionValid</span><span class="token punctuation">(</span>subExpression<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> subExpression<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> maxLength<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                maxLength <span class="token operator">=</span> subExpression<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                maximumResult <span class="token operator">=</span> <span class="token function">calculateExpressionResult</span><span class="token punctuation">(</span>subExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 打印最大计算结果</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> maximumResult <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="Java2_763"></a>Java解法2</h2> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 检查表达式是否有效</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">isExpressionValid</span><span class="token punctuation">(</span><span class="token class-name">String</span> expression<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取表达式的第一个字符</span>
        <span class="token keyword">char</span> firstChar <span class="token operator">=</span> expression<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 检查第一个字符是否为运算符或数字，如果不是，则返回false</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>firstChar <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> firstChar <span class="token operator">==</span> <span class="token char">'-'</span> <span class="token operator">||</span><span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isDigit</span><span class="token punctuation">(</span>firstChar<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 用于记录运算符的位置</span>
        <span class="token keyword">int</span> operatorIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> expression<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">char</span> currentChar <span class="token operator">=</span> expression<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 判断当前字符是否为运算符</span>
            <span class="token keyword">boolean</span> isOperator <span class="token operator">=</span> currentChar <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> currentChar <span class="token operator">==</span> <span class="token char">'-'</span> <span class="token operator">||</span> currentChar <span class="token operator">==</span> <span class="token char">'*'</span><span class="token punctuation">;</span>
            <span class="token comment">// 判断当前字符是否为数字</span>
            <span class="token keyword">boolean</span> isDigit <span class="token operator">=</span> <span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">isDigit</span><span class="token punctuation">(</span>currentChar<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 如果当前字符既不是运算符也不是数字，则表达式无效</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isOperator <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isDigit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 如果找到运算符，并且之前已经记录过运算符的位置，则表达式无效（不允许有多个运算符）</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isOperator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>operatorIndex <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    operatorIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 防止表达式以双加号或双减号开头，以及表达式以运算符结尾</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>firstChar <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> firstChar <span class="token operator">==</span> <span class="token char">'-'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> operatorIndex <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>operatorIndex <span class="token operator">==</span> expression<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token comment">// 确保表达式中至少包含一个运算符</span>
        <span class="token keyword">return</span> operatorIndex <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> input <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 存储最大的计算结果</span>
        <span class="token keyword">long</span> maximumResult <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">// 存储最长的有效表达式长度</span>
        <span class="token keyword">int</span> maxLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token comment">// 遍历输入字符串的所有子串</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> start <span class="token operator">&lt;</span> input<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> start<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> end <span class="token operator">=</span> start<span class="token punctuation">;</span> end <span class="token operator">&lt;</span> input<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> end<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 获取子串</span>
                <span class="token class-name">String</span> subExpression <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 如果子串是有效的表达式，并且长度大于当前记录的最长长度，则计算结果</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isExpressionValid</span><span class="token punctuation">(</span>subExpression<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> subExpression<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> maxLength<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    maxLength <span class="token operator">=</span> subExpression<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    maximumResult <span class="token operator">=</span> <span class="token function">calculateExpressionResult</span><span class="token punctuation">(</span>subExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 打印最大计算结果</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>maximumResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        scanner<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 计算有效表达式的结果</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">calculateExpressionResult</span><span class="token punctuation">(</span><span class="token class-name">String</span> validExpression<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 找到运算符的位置</span>
        <span class="token keyword">int</span> operatorIndex <span class="token operator">=</span> <span class="token function">findOperatorIndex</span><span class="token punctuation">(</span>validExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 获取运算符左边的数</span>
        <span class="token class-name">String</span> leftOperand <span class="token operator">=</span> validExpression<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> operatorIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取运算符</span>
        <span class="token keyword">char</span> operator <span class="token operator">=</span> validExpression<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>operatorIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取运算符右边的数</span>
        <span class="token class-name">String</span> rightOperand <span class="token operator">=</span> validExpression<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>operatorIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 将字符串转换为数字</span>
        <span class="token keyword">long</span> leftNumber <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>leftOperand<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> rightNumber <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>rightOperand<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 根据运算符执行相应的计算</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>operator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token char">'+'</span><span class="token operator">:</span> <span class="token keyword">return</span> leftNumber <span class="token operator">+</span> rightNumber<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'-'</span><span class="token operator">:</span> <span class="token keyword">return</span> leftNumber <span class="token operator">-</span> rightNumber<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'*'</span><span class="token operator">:</span> <span class="token keyword">return</span> leftNumber <span class="token operator">*</span> rightNumber<span class="token punctuation">;</span>
            <span class="token comment">// 如果运算符不是预期的，抛出异常</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 寻找运算符的位置</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">findOperatorIndex</span><span class="token punctuation">(</span><span class="token class-name">String</span> expression<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> expression<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>expression<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> expression<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'-'</span> <span class="token operator">||</span> expression<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'*'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 如果表达式有效，这里不应该到达</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="javaScript2_878"></a>javaScript解法2</h2> 
<pre><code class="prism language-js"><span class="token keyword">const</span> readline <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'readline'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建readline接口实例</span>
<span class="token keyword">const</span> rl <span class="token operator">=</span> readline<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdout
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 检查表达式是否有效</span>
<span class="token keyword">function</span> <span class="token function">isExpressionValid</span><span class="token punctuation">(</span><span class="token parameter">expression</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 获取表达式的第一个字符</span>
  <span class="token keyword">const</span> firstChar <span class="token operator">=</span> expression<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 检查第一个字符是否为运算符或数字，如果不是，则返回false</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>firstChar <span class="token operator">===</span> <span class="token string">'+'</span> <span class="token operator">||</span> firstChar <span class="token operator">===</span> <span class="token string">'-'</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>firstChar<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 用于记录运算符的位置</span>
  <span class="token keyword">let</span> operatorIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> expression<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> currentChar <span class="token operator">=</span> expression<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 判断当前字符是否为运算符</span>
    <span class="token keyword">const</span> isOperator <span class="token operator">=</span> currentChar <span class="token operator">===</span> <span class="token string">'+'</span> <span class="token operator">||</span> currentChar <span class="token operator">===</span> <span class="token string">'-'</span> <span class="token operator">||</span> currentChar <span class="token operator">===</span> <span class="token string">'*'</span><span class="token punctuation">;</span>
    <span class="token comment">// 判断当前字符是否为数字</span>
    <span class="token keyword">const</span> isDigit <span class="token operator">=</span> <span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>currentChar<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果当前字符既不是运算符也不是数字，则表达式无效</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isOperator <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isDigit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 如果找到运算符，并且之前已经记录过运算符的位置，则表达式无效（不允许有多个运算符）</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isOperator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>operatorIndex <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        operatorIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 防止表达式以双加号或双减号开头，以及表达式以运算符结尾</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>firstChar <span class="token operator">===</span> <span class="token string">'+'</span> <span class="token operator">||</span> firstChar <span class="token operator">===</span> <span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> operatorIndex <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>operatorIndex <span class="token operator">===</span> expression<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment">// 确保表达式中至少包含一个运算符</span>
  <span class="token keyword">return</span> operatorIndex <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 计算有效表达式的结果</span>
<span class="token keyword">function</span> <span class="token function">calculateExpressionResult</span><span class="token punctuation">(</span><span class="token parameter">validExpression</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 找到运算符的位置</span>
  <span class="token keyword">const</span> operatorIndex <span class="token operator">=</span> <span class="token function">findOperatorIndex</span><span class="token punctuation">(</span>validExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取运算符左边的数和右边的数</span>
  <span class="token keyword">const</span> leftNumber <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>validExpression<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> operatorIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> rightNumber <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>validExpression<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>operatorIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取运算符</span>
  <span class="token keyword">const</span> operator <span class="token operator">=</span> validExpression<span class="token punctuation">[</span>operatorIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// 根据运算符执行相应的计算</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>operator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span> <span class="token string">'+'</span><span class="token operator">:</span> <span class="token keyword">return</span> leftNumber <span class="token operator">+</span> rightNumber<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'-'</span><span class="token operator">:</span> <span class="token keyword">return</span> leftNumber <span class="token operator">-</span> rightNumber<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">'*'</span><span class="token operator">:</span> <span class="token keyword">return</span> leftNumber <span class="token operator">*</span> rightNumber<span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 寻找运算符的位置</span>
<span class="token keyword">function</span> <span class="token function">findOperatorIndex</span><span class="token punctuation">(</span><span class="token parameter">expression</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> expression<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>expression<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 如果表达式有效，这里不应该到达</span>
  <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

rl<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'line'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> maximumResult <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> maxLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">// 遍历输入字符串的所有子串</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> start <span class="token operator">&lt;</span> input<span class="token punctuation">.</span>length<span class="token punctuation">;</span> start<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> end <span class="token operator">=</span> start<span class="token punctuation">;</span> end <span class="token operator">&lt;</span> input<span class="token punctuation">.</span>length<span class="token punctuation">;</span> end<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 获取子串</span>
      <span class="token keyword">const</span> subExpression <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 如果子串是有效的表达式，并且长度大于当前记录的最长长度，则计算结果</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isExpressionValid</span><span class="token punctuation">(</span>subExpression<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> subExpression<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> maxLength<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        maxLength <span class="token operator">=</span> subExpression<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        maximumResult <span class="token operator">=</span> <span class="token function">calculateExpressionResult</span><span class="token punctuation">(</span>subExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 打印最大计算结果</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>maximumResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
  rl<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="Python2_988"></a>Python解法2</h2> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">is_expression_valid</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    检查表达式是否有效
    :param expression: 表达式字符串
    :return: 布尔值，表达式是否有效
    """</span>
    <span class="token comment"># 获取表达式的第一个字符</span>
    first_char <span class="token operator">=</span> expression<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment"># 检查第一个字符是否为运算符或数字，如果不是，则返回False</span>
    <span class="token keyword">if</span> first_char <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> <span class="token keyword">not</span> first_char<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token comment"># 用于记录运算符的位置</span>
    operator_index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        current_char <span class="token operator">=</span> expression<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

        <span class="token comment"># 判断当前字符是否为运算符</span>
        is_operator <span class="token operator">=</span> current_char <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">]</span>
        <span class="token comment"># 判断当前字符是否为数字</span>
        is_digit <span class="token operator">=</span> current_char<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 如果当前字符既不是运算符也不是数字，则表达式无效</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> is_operator <span class="token keyword">and</span> <span class="token keyword">not</span> is_digit<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>

        <span class="token comment"># 如果找到运算符，并且之前已经记录过运算符的位置，则表达式无效（不允许有多个运算符）</span>
        <span class="token keyword">if</span> is_operator<span class="token punctuation">:</span>
            <span class="token keyword">if</span> operator_index <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">False</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                operator_index <span class="token operator">=</span> i

    <span class="token comment"># 防止表达式以双加号或双减号开头，以及表达式以运算符结尾</span>
    <span class="token keyword">if</span> first_char <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> operator_index <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">if</span> operator_index <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token comment"># 确保表达式中至少包含一个运算符</span>
    <span class="token keyword">return</span> operator_index <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span>

<span class="token keyword">def</span> <span class="token function">calculate_expression_result</span><span class="token punctuation">(</span>valid_expression<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    计算有效表达式的结果
    :param valid_expression: 有效的表达式字符串
    :return: 计算结果
    """</span>
    <span class="token comment"># 找到运算符的位置</span>
    operator_index <span class="token operator">=</span> find_operator_index<span class="token punctuation">(</span>valid_expression<span class="token punctuation">)</span>

    <span class="token comment"># 获取运算符左边的数和右边的数</span>
    left_operand <span class="token operator">=</span> valid_expression<span class="token punctuation">[</span><span class="token punctuation">:</span>operator_index<span class="token punctuation">]</span>
    right_operand <span class="token operator">=</span> valid_expression<span class="token punctuation">[</span>operator_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

    <span class="token comment"># 将字符串转换为数字</span>
    left_number <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>left_operand<span class="token punctuation">)</span>
    right_number <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>right_operand<span class="token punctuation">)</span>

    <span class="token comment"># 获取运算符</span>
    operator <span class="token operator">=</span> valid_expression<span class="token punctuation">[</span>operator_index<span class="token punctuation">]</span>

    <span class="token comment"># 根据运算符执行相应的计算</span>
    <span class="token keyword">if</span> operator <span class="token operator">==</span> <span class="token string">'+'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> left_number <span class="token operator">+</span> right_number
    <span class="token keyword">elif</span> operator <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> left_number <span class="token operator">-</span> right_number
    <span class="token keyword">elif</span> operator <span class="token operator">==</span> <span class="token string">'*'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> left_number <span class="token operator">*</span> right_number
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Unexpected operator: "</span> <span class="token operator">+</span> operator<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">find_operator_index</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    寻找运算符的位置
    :param expression: 表达式字符串
    :return: 运算符的位置索引
    """</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> expression<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> i
    <span class="token comment"># 如果表达式有效，这里不应该到达</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 读取输入</span>
    input_expression <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    maximum_result <span class="token operator">=</span> <span class="token number">0</span>
    max_length <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token comment"># 遍历输入字符串的所有子串</span>
    <span class="token keyword">for</span> start <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>input_expression<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> end <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>input_expression<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 获取子串</span>
            sub_expression <span class="token operator">=</span> input_expression<span class="token punctuation">[</span>start<span class="token punctuation">:</span>end<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span>

            <span class="token comment"># 如果子串是有效的表达式，并且长度大于当前记录的最长长度，则计算结果</span>
            <span class="token keyword">if</span> is_expression_valid<span class="token punctuation">(</span>sub_expression<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sub_expression<span class="token punctuation">)</span> <span class="token operator">&gt;</span> max_length<span class="token punctuation">:</span>
                max_length <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sub_expression<span class="token punctuation">)</span>
                maximum_result <span class="token operator">=</span> calculate_expression_result<span class="token punctuation">(</span>sub_expression<span class="token punctuation">)</span>

    <span class="token comment"># 打印最大计算结果</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>maximum_result<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="C2_1095"></a>C语言解法2</h2> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ctype.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token comment">// 检查给定的字符串表达式是否为有效的算术表达式</span>
<span class="token keyword">int</span> <span class="token function">isExpressionValid</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> expression<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 检查表达式的第一个字符是否为正负号或数字</span>
    <span class="token keyword">char</span> firstChar <span class="token operator">=</span> expression<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>firstChar <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> firstChar <span class="token operator">==</span> <span class="token char">'-'</span> <span class="token operator">||</span> <span class="token function">isdigit</span><span class="token punctuation">(</span>firstChar<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 如果不是，则表达式无效</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 记录找到的运算符位置，初始值为-1，表示未找到</span>
    <span class="token keyword">int</span> operatorIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> expression<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">char</span> currentChar <span class="token operator">=</span> expression<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 检查当前字符是否为运算符</span>
        <span class="token keyword">int</span> isOperator <span class="token operator">=</span> currentChar <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> currentChar <span class="token operator">==</span> <span class="token char">'-'</span> <span class="token operator">||</span> currentChar <span class="token operator">==</span> <span class="token char">'*'</span><span class="token punctuation">;</span>
        <span class="token comment">// 检查当前字符是否为数字</span>
        <span class="token keyword">int</span> isDigit <span class="token operator">=</span> <span class="token function">isdigit</span><span class="token punctuation">(</span>currentChar<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果当前字符既不是运算符也不是数字，则表达式无效</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isOperator <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isDigit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 如果当前字符是运算符，并且之前已经找到过运算符，则表达式无效</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isOperator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>operatorIndex <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
            operatorIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 防止表达式以运算符开头但紧接着又是一个运算符，或以运算符结尾</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>firstChar <span class="token operator">==</span> <span class="token char">'+'</span> <span class="token operator">||</span> firstChar <span class="token operator">==</span> <span class="token char">'-'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> operatorIndex <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>operatorIndex <span class="token operator">==</span> <span class="token function">strlen</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">// 如果至少找到一个运算符，则表达式有效</span>
    <span class="token keyword">return</span> operatorIndex <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 计算有效表达式的结果</span>
<span class="token keyword">long</span> <span class="token function">calculateExpressionResult</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> validExpression<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 查找运算符位置</span>
    <span class="token keyword">char</span><span class="token operator">*</span> operatorPos <span class="token operator">=</span> <span class="token function">strpbrk</span><span class="token punctuation">(</span>validExpression <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"+-*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 分离出运算符左边的数字</span>
    <span class="token keyword">char</span> leftStr<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">strncpy</span><span class="token punctuation">(</span>leftStr<span class="token punctuation">,</span> validExpression<span class="token punctuation">,</span> operatorPos <span class="token operator">-</span> validExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> leftNum <span class="token operator">=</span> <span class="token function">strtol</span><span class="token punctuation">(</span>leftStr<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将字符串转换为长整型数字</span>

    <span class="token comment">// 运算符右边的数字</span>
    <span class="token keyword">long</span> rightNum <span class="token operator">=</span> <span class="token function">strtol</span><span class="token punctuation">(</span>operatorPos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 根据运算符类型计算结果</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>operatorPos<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token char">'+'</span><span class="token operator">:</span> <span class="token keyword">return</span> leftNum <span class="token operator">+</span> rightNum<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'-'</span><span class="token operator">:</span> <span class="token keyword">return</span> leftNum <span class="token operator">-</span> rightNum<span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token char">'*'</span><span class="token operator">:</span> <span class="token keyword">return</span> leftNum <span class="token operator">*</span> rightNum<span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果运算符不是预期的，程序异常终止</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> input<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">fgets</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读取一行输入到input数组中</span>

    <span class="token keyword">long</span> maximumResult <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 存储最大结果</span>
    <span class="token keyword">int</span> maxLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 存储最长有效表达式的长度</span>

    <span class="token comment">// 遍历所有可能的子串</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> start <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>start<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> end <span class="token operator">=</span> start <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> end <span class="token operator">&lt;=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>end<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">char</span> subExpr<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">// 从输入中提取子表达式</span>
            <span class="token function">strncpy</span><span class="token punctuation">(</span>subExpr<span class="token punctuation">,</span> input <span class="token operator">+</span> start<span class="token punctuation">,</span> end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 检查子表达式是否有效，并计算结果</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isExpressionValid</span><span class="token punctuation">(</span>subExpr<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">&gt;</span> maxLength<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">long</span> result <span class="token operator">=</span> <span class="token function">calculateExpressionResult</span><span class="token punctuation">(</span>subExpr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 更新最大结果和最长有效表达式长度</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>maxLength <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> maxLength<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    maxLength <span class="token operator">=</span> end <span class="token operator">-</span> start<span class="token punctuation">;</span>
                    maximumResult <span class="token operator">=</span> result<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%ld\n"</span><span class="token punctuation">,</span> maximumResult<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印最大结果</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_1188"></a>完整用例</h2> 
<h3><a id="1_1190"></a>用例1</h3> 
<pre><code class="prism language-input1">123+456*789
</code></pre> 
<h3><a id="2_1196"></a>用例2</h3> 
<pre><code class="prism language-input2">5*6-3+2abcd
</code></pre> 
<h3><a id="3_1202"></a>用例3</h3> 
<pre><code class="prism language-input3">abc-5*6+3*2
</code></pre> 
<h3><a id="4_1208"></a>用例4</h3> 
<pre><code class="prism language-input4">1+2*3-4/0abc
</code></pre> 
<h3><a id="6_1216"></a>用例6</h3> 
<pre><code class="prism language-input6">1-2*3+4*5-6*7+8*9
</code></pre> 
<h3><a id="7_1222"></a>用例7</h3> 
<pre><code class="prism language-input7">1-2*3+4*5-6*7+8*9abcd
</code></pre> 
<h3><a id="8_1228"></a>用例8</h3> 
<pre><code class="prism language-input8">1+1+1+1+1
</code></pre> 
<h3><a id="9_1234"></a>用例9</h3> 
<pre><code class="prism language-input9">abcdefghijklmnopqrstuvwxyz
</code></pre> 
<h3><a id="10_1240"></a>用例10</h3> 
<pre><code class="prism language-input10">0-1+2-3+4-5+6-7+8-9
</code></pre> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#200_4" rel="nofollow">题目描述：最长合法表达式（本题分值200）</a></li><li><a href="#_28" rel="nofollow">输入描述</a></li><li><a href="#_32" rel="nofollow">输出描述</a></li><li><a href="#_36" rel="nofollow">用例</a></li><li><a href="#_52" rel="nofollow">提示,必看！！！</a></li><li><a href="#1_65" rel="nofollow">解法1</a></li><li><a href="#C1_81" rel="nofollow">C++解法1</a></li><li><a href="#Java1_206" rel="nofollow">Java解法1</a></li><li><a href="#javaScript1_336" rel="nofollow">javaScript解法1</a></li><li><a href="#Python1_458" rel="nofollow">Python解法1</a></li><li><a href="#C1_545" rel="nofollow">C语言解法1</a></li><li><a href="#2_668" rel="nofollow">以下是另一个角度的解法2</a></li><li><a href="#C2_672" rel="nofollow">C++解法2</a></li><li><a href="#Java2_763" rel="nofollow">Java解法2</a></li><li><a href="#javaScript2_878" rel="nofollow">javaScript解法2</a></li><li><a href="#Python2_988" rel="nofollow">Python解法2</a></li><li><a href="#C2_1095" rel="nofollow">C语言解法2</a></li><li><a href="#_1188" rel="nofollow">完整用例</a></li><li><ul><li><a href="#1_1190" rel="nofollow">用例1</a></li><li><a href="#2_1196" rel="nofollow">用例2</a></li><li><a href="#3_1202" rel="nofollow">用例3</a></li><li><a href="#4_1208" rel="nofollow">用例4</a></li><li><a href="#6_1216" rel="nofollow">用例6</a></li><li><a href="#7_1222" rel="nofollow">用例7</a></li><li><a href="#8_1228" rel="nofollow">用例8</a></li><li><a href="#9_1234" rel="nofollow">用例9</a></li><li><a href="#10_1240" rel="nofollow">用例10</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/169f277a87c29b8ff13d65ef9e7eeec7.png" alt="fengmian"></p>
                </div>
</body>
</html>
